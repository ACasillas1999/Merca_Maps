<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa de Sucursales y Rutas | Grupo Ascencio</title>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="assets/img/logo-mercamaps.png">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <header class="hero">
    <div class="hero__copy">
      <p class="eyebrow">Grupo Ascencio</p>
      <h1>Mapa de sucursales, Clientes y Competencia</h1>
      <p class="lede">Marca y clasifica ubicaciones del Grupo Ascencio.</p>
    </div>
    <div class="hero__actions">
      <button id="open-users-admin" class="ghost btn-icon btn-users" hidden>Usuarios (admin)</button>
      <button id="logout-btn" class="ghost btn-icon btn-logout" hidden>Salir</button>
      <div class="metrics" id="metric-types"></div>
      <div class="metric">
        <p class="label">Ubicaciones</p>
        <p class="value" id="metric-locations">0</p>
      </div>
    </div>
  </header>

  <main class="layout layout--map-right">
    <section class="panel panel-left" id="side-panel">
      <div class="panel__header">
        <div>
          <h2>Ubicaciones</h2>
          <p class="muted">Listado al dia de sucursales y proveedores.</p>
        </div>
        <button id="open-modal" class="primary">Nueva ubicacion</button>
      </div>
      <div class="filters filters--wide" id="filters"></div>
      <label class="field">
        <span>Buscar ubicacion</span>
        <input type="search" id="locations-search" placeholder="Filtrar por nombre o nota">
      </label>
      <div id="locations-list" class="list map-list"></div>
    </section>

    <section class="map-panel">
      <button type="button" class="drawer-toggle btn-icon btn-menu" id="menu-toggle">Menú</button>
      <div id="drawer-overlay" class="drawer-overlay" hidden></div>
      <div class="nav-search-card is-collapsed">
        <div class="nav-search-head">
          <div>
            <strong>Ruta rapida</strong>
            <p class="muted">Busca una direccion y traza la ruta.</p>
            <p class="muted nav-summary" id="nav-summary">Origen: -- -> Destino: --</p>
          </div>
          <button type="button" class="ghost small" id="nav-toggle">Expandir</button>
        </div>
        <div class="nav-search-body">
          <div id="geocoder" class="geocoder"></div>
          <div class="nav-actions">
            <button type="button" class="ghost small icon-square" id="btn-route-from-search" title="Trazar ruta">➤ Ruta</button>
            <button type="button" class="ghost small icon-square" id="btn-route-from-current" title="Mi ubicación">📍 Origen</button>
            <button type="button" class="ghost small icon-square" id="btn-open-gmaps" title="Ver en Google Maps">🗺️ Maps</button>
            <button type="button" class="ghost small icon-square" id="btn-clear-nav" title="Limpiar">✕ Limpiar</button>
          </div>
            <label class="field inline-traffic">
              <span>Capas</span>
            <label class="traffic-toggle"><input type="checkbox" id="toggle-traffic"> Mostrar trafico</label>
          </label>
          <p class="muted nav-status" id="nav-status">Selecciona una direccion para trazar.</p>
        </div>
      </div>
      <div id="map"></div>
    </section>
  </main>

  <div id="modal-backdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal__header">
        <div>
          <p class="eyebrow">Nueva ubicacion</p>
          <h3>Registrar punto</h3>
        </div>
        <button type="button" id="modal-close" class="ghost">Cerrar</button>
      </div>
      <p class="muted">Haz clic en el mapa para precargar latitud y longitud.</p>
      <form id="location-form" class="stack modal__form">
        <label class="field">
          <span>Nombre</span>
          <input type="text" id="loc-name" placeholder="Sucursal" required>
        </label>
        <label class="field">
          <span>Tipo</span>
          <select id="loc-type" required>
            <option value="sucursal">Sucursal</option>
            <option value="proveedor">Proveedor</option>
            <option value="competencia">Competencia</option>
            <option value="clientes_potenciales">Clientes potenciales</option>
            <option value="otro">Otro</option>
          </select>
        </label>
        <div class="grid-2">
          <label class="field">
            <span>Latitud</span>
            <input type="number" step="any" id="loc-lat" placeholder="25.6866" required>
          </label>
          <label class="field">
            <span>Longitud</span>
            <input type="number" step="any" id="loc-lng" placeholder="-100.3161" required>
          </label>
        </div>
        <label class="field">
          <span>Descripcion</span>
          <textarea id="loc-notes" rows="2" placeholder="Contacto, horarios, etc."></textarea>
        </label>
        <div class="modal__actions">
          <button type="button" class="ghost" id="modal-cancel">Cancelar</button>
          <button type="submit" class="primary">Guardar ubicacion</button>
        </div>
      </form>
    </div>
  </div>

  <div id="route-modal-backdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal__header">
        <div>
          <p class="eyebrow">Nueva ruta</p>
          <h3>Crear y asignar</h3>
        </div>
        <button type="button" id="route-modal-close" class="ghost">Cerrar</button>
      </div>
      <p class="muted">Selecciona las paradas en orden y asigna un responsable.</p>
      <form id="route-form" class="stack modal__form">
        <label class="field">
          <span>Nombre de ruta</span>
          <input type="text" id="route-name" placeholder="Ruta Norte" required>
        </label>
        <label class="field">
          <span>Asignar a</span>
          <input type="text" id="route-user" placeholder="Operador / usuario" required>
        </label>
        <label class="field">
          <span>Agregar parada</span>
          <div class="inline">
            <select id="route-stop"></select>
            <button type="button" id="add-stop" class="ghost">Agregar</button>
          </div>
        </label>
        <div id="stops-preview" class="chips"></div>
        <div class="modal__actions">
          <button type="button" class="ghost" id="route-modal-cancel">Cancelar</button>
          <button type="submit" class="primary">Guardar ruta</button>
        </div>
      </form>
    </div>
  </div>

  <script src='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
  <script type="module" src="assets/js/app.js"></script>

  <div id="users-modal-backdrop" class="modal-backdrop" hidden>
    <div class="modal modal--users">
      <div class="modal__header">
        <div>
          <p class="eyebrow">Usuarios</p>
          <h3>Gestionar cuentas</h3>
        </div>
        <button type="button" id="users-modal-close" class="ghost">Cerrar</button>
      </div>
      <p class="muted">Solo administradores pueden crear, editar o eliminar usuarios.</p>
      <form id="user-form-inline" class="stack modal__form">
        <label class="field">
          <span>Nombre</span>
          <input type="text" id="user-name" placeholder="Nombre completo" required>
        </label>
        <label class="field">
          <span>Correo</span>
          <input type="email" id="user-email" placeholder="correo@dominio.com" required>
        </label>
        <label class="field">
          <span>Contrase?a</span>
          <input type="password" id="user-password" placeholder="Minimo 6 caracteres">
          <small class="muted">D?jalo vac?o al editar para no cambiarla.</small>
        </label>
        <label class="field">
          <span>Rol</span>
          <select id="user-role">
            <option value="user">Usuario</option>
            <option value="admin">Administrador</option>
          </select>
        </label>
        <div class="modal__actions">
          <button type="button" class="ghost" id="users-modal-cancel">Cancelar</button>
          <button type="submit" class="primary" id="user-submit">Crear usuario</button>
        </div>
      </form>
      <p id="users-status" class="muted" role="status"></p>
      <section id="users-list" class="stack users-list"></section>
    </div>
  </div>

</body>
</html>
